#:import CeedData ceed.storage.controller.CeedData
#:import Clock kivy.clock.Clock

<DataBar@BoxLayout>:
    size_hint: None, None
    size: self.minimum_width, '34dp'
    more: more.__self__
    BoxLayout:
        padding: '5dp'
        spacing: '5dp'
        size_hint_x: None
        width: self.minimum_width
        id: box
        on_parent: Clock.schedule_once(lambda *x: self.remove_widget(more.__self__))
        FlatImageButton:
            scale_down_color: True
            source: 'flat_save.png'
            flat_color: app.theme.accent
            on_release:
                if CeedData.filename: CeedData.save()
                if not CeedData.filename: app.filebrowser.target = CeedData.root_path
                if not CeedData.filename: app.filebrowser.dirselect =  app.filebrowser.multiselect = False
                if not CeedData.filename: app.filebrowser.callback = CeedData.get_filebrowser_callback(CeedData.save_as, True)
                if not CeedData.filename: app.filebrowser.open()
        FlatImageButton:
            scale_down_color: True
            source: 'flat_menu_down.png'
            flat_color: app.theme.accent
            on_release: root.more.open(self.parent)
        FlatDropDown:
            id: more
            flat_color: app.theme.primary_text
            flat_border_color: app.theme.divider
            FlatButton:
                text: 'Save as'
                size_hint: None, None
                size: self.texture_size
                scale_down_color: True
                flat_color: app.theme.text_primary
                on_release:
                    app.filebrowser.target = CeedData.root_path
                    app.filebrowser.dirselect =  app.filebrowser.multiselect = False
                    app.filebrowser.callback = CeedData.get_filebrowser_callback(CeedData.save_as, True)
                    app.filebrowser.open()
            FlatButton:
                text: 'Create'
                size_hint: None, None
                size: self.texture_size
                scale_down_color: True
                flat_color: app.theme.text_primary
                on_release:
                    app.filebrowser.target = CeedData.root_path
                    app.filebrowser.dirselect =  app.filebrowser.multiselect = False
                    app.filebrowser.callback = CeedData.get_filebrowser_callback(CeedData.create_file, True, True)
                    app.filebrowser.open()
            FlatButton:
                text: 'Open'
                size_hint: None, None
                size: self.texture_size
                scale_down_color: True
                flat_color: app.theme.text_primary
                on_release:
                    app.filebrowser.target = CeedData.root_path
                    app.filebrowser.dirselect =  app.filebrowser.multiselect = False
                    app.filebrowser.callback = CeedData.get_filebrowser_callback(CeedData.open_file, clear_data=True)
                    app.filebrowser.open()
            FlatButton:
                text: 'Import'
                size_hint: None, None
                size: self.texture_size
                scale_down_color: True
                flat_color: app.theme.text_primary
                on_release:
                    app.filebrowser.target = CeedData.root_path
                    app.filebrowser.dirselect =  app.filebrowser.multiselect = False
                    app.filebrowser.callback = CeedData.get_filebrowser_callback(CeedData.import_file)
                    app.filebrowser.open()
            FlatButton:
                text: 'Close'
                size_hint: None, None
                size: self.texture_size
                scale_down_color: True
                flat_color: app.theme.text_primary
                on_release: CeedData.ui_close()
            FlatButton:
                text: 'Discard'
                size_hint: None, None
                size: self.texture_size
                scale_down_color: True
                flat_color: app.theme.text_primary
                on_release: CeedData.discard_file()
            FlatButton:
                text: 'Load YAML'
                size_hint: None, None
                size: self.texture_size
                scale_down_color: True
                flat_color: app.theme.text_primary
                on_release:
                    app.filebrowser.target = CeedData.root_path
                    app.filebrowser.dirselect =  app.filebrowser.multiselect = False
                    app.filebrowser.callback = CeedData.get_filebrowser_callback(CeedData.read_yaml_config)
                    app.filebrowser.open()
            FlatButton:
                text: 'Save YAML'
                size_hint: None, None
                size: self.texture_size
                scale_down_color: True
                flat_color: app.theme.text_primary
                on_release:
                    app.filebrowser.target = CeedData.root_path
                    app.filebrowser.dirselect =  app.filebrowser.multiselect = False
                    app.filebrowser.callback = CeedData.get_filebrowser_callback(CeedData.write_yaml_config, True)
                    app.filebrowser.open()
