#:import Factory kivy.factory.Factory

<FuncListing@FlatSplitter>:
    size_hint_x: None
    width: '200dp'
    sizable_from: 'left'
    strip_size: '5dp'
    min_size: '15dp'
    max_size: dp(400) + max(funcs.minimum_width, control_box.minimum_width)
    spacing: '5dp'
    flat_color: app.theme.accent
    BoxLayout:
        orientation: 'vertical'
        ScrollView:
            bar_width: '10dp'
            scroll_type: ['bars']
            do_scroll_y: False
            size_hint_y: None
            height: '68dp'
            BoxLayout:
                size_hint_min_x: control_box.minimum_width
                orientation: 'vertical'
                FlatLabel:
                    text: 'Functions'
                    flat_color: app.theme.text_primary
                BoxLayout:
                    id: control_box
                    orientation: 'horizontal'
                    padding: '5dp'
                    spacing: '5dp'
                    FlatSpinner:
                        id: func_spin
                        values: sorted(app.function_factory.funcs_inst.keys()) if app.function_factory.funcs_inst else []
                        text_autoupdate: True
                        size_hint_min_x: self.minimum_width
                        flat_color: app.theme.text_primary
                        flat_menu_color: app.theme.accent
                        flat_drop_background_color: app.theme.primary_text
                        flat_drop_text_color: app.theme.text_primary
                        flat_border_color: app.theme.divider
                    DraggingWidget:
                        drag_controller: knspace.dragger
                        drag_widget: func_spin.__self__
                        obj_dragged: func_spin.__self__
                        drag_cls: 'func_spinner'
                    FlatImageButton:
                        scale_down_color: True
                        source: 'flat_plus.png'
                        flat_color: app.theme.accent
                        on_release: funcs.add_func(func_spin.text)
        ScrollView:
            bar_width: '10dp'
            scroll_type: ['bars']
            FuncList:
                id: funcs
                drag_append_end: True
                spacer_props: {'size_hint_y': None, 'height': '50dp', 'size_hint_min_x': '40dp'}
                drag_classes: ['func', 'func_spinner']
                function_factory: app.function_factory
                knsname: 'funcs'
                orientation: 'vertical'
                spacing: '3dp'
                padding: '0dp', '0dp', '0dp', '12dp'
                size_hint_y: None
                height: self.minimum_height
                size_hint_min_x: self.minimum_width
                touch_deselect_last: True
                canvas:
                    Color:
                        rgba: (152 / 255., 153 / 255., 155 / 255., 1.) if app.drag_controller.dragging and app.drag_controller.widget_dragged and app.drag_controller.widget_dragged.drag_cls in ('func', 'func_spinner') else (0, 0, 0, 0)
                    Rectangle:
                        pos: self.pos
                        size: self.width, dp(10)


<FuncPropTextWidget>:
    size_hint_y: None
    height: self.minimum_height
    multiline: False
    on_focus: if not self.focus: self._update_attr(self.text)


<FuncSettingsDropDown>:
    do_scroll: False, False
    flat_color: app.theme.primary_text
    flat_border_color: app.theme.divider
    splitter: splitter
    settings: settings
    FlatSplitter:
        id: splitter
        size_hint: None, None
        sizable_from: 'left'
        flat_color: app.theme.accent
        height: self.minimum_height
        min_size: self.minimum_width
        BoxLayout:
            id: settings
            size_hint_y: None
            orientation: 'vertical'
            spacing: '5dp'
            padding: '5dp'
            height: self.minimum_height
            size_hint_min_x: self.minimum_width
            FuncNamePropTextWidget:
                func: root.func_widget.ref_func or root.func_widget.func
                prop_name: 'name'
                on_parent: self.apply_binding()
                disabled: root.func_widget.func.parent_func is not None
            FlatLabel:
                padding: '5dp', '5dp'
                size_hint_y: None
                halign: 'center'
                flat_color: app.theme.text_primary
                height: self.texture_size[1]
                text_size: self.width, None
                text: root.func_widget.func.description


<FuncNoiseDropDown@FlatDropDown>:
    do_scroll: False, False
    flat_color: app.theme.primary_text
    flat_border_color: app.theme.divider
    container: container
    FlatSplitter:
        size_hint: None, None
        sizable_from: 'left'
        flat_color: app.theme.accent
        height: self.minimum_height
        min_size: self.minimum_width
        BoxLayout:
            id: container
            size_hint_y: None
            orientation: 'vertical'
            spacing: '5dp'
            padding: '5dp'
            height: self.minimum_height
            size_hint_min_x: self.minimum_width


<NoiseSelection@FlatImageButton>:
    more_widget: None
    scale_down_color: True
    source: 'flat_dots_vertical.png'
    flat_color: app.theme.accent
    on_release: self.more_widget.open(root)
